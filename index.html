<!DOCTYPE html>
<html>

<head>
	<meta name="viewport" content="initial-scale=1.0">
	<meta charset="utf-8">
	<title>KML Layers</title>
	<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.0/themes/smoothness/jquery-ui.css" integrity="sha256-OKtZU6RoyAhNskUqQr3Fmmvhl7q42tQQXAQLYxhhVek="
	 crossorigin="anonymous">
	<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB"
	 crossorigin="anonymous">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.10/css/all.css" integrity="sha384-+d0P83n9kaQMCwj8F4RJB66tzIwOKmrdb46+porD/OvrJ+37WqIM7UoBtwHO6Nlg"
	 crossorigin="anonymous">
	<style>
		#map {
			height: 100%;
		}

		html,
		body {
			height: 100%;
			margin: 0;
			padding: 0;
		}

		#sidebar {
			/* for the animation */
			transition: margin 0.3s ease;
			border-bottom: 1px solid black;
			padding: 0;
		}

		.collapsed {
			/* hide it for small displays*/
			display: none;
		}
		
		#toggle-container {
			position: relative;
			top: -1px;
			left: 0;
			width: 0;
			height: 0;
			z-index: 100;
		}

		#toggle {
			position: absolute;
			top: 0;
			left: 0;
			cursor: pointer;
			background-color: white;
			color: #222222;
			font-weight: bold;
			border-right: 1px solid black;
			border-bottom: 1px solid black;
			padding: 10px;
		}

		#content {
			padding: 0;
		}

		img.photo {
			width: 100px;
		}

		div.image-container {
			height: 140px;
			width: 100px;
			overflow: hidden;
			margin: 10px;
			float: left;
		}

		.ui-widget-header {
			background-image: none;
			background-color: #eeeeee;
		}

		.ui-corner-all,
		.ui-corner-bottom,
		.ui-corner-left,
		.ui-corner-bl {
			border-bottom-left-radius: 0;
			border-bottom-right-radius: 0;
			border-top-left-radius: 0;
			border-top-right-radius: 0;
		}

		#tabs {
			padding: 0;
			border: none;
		}

		.ui-widget-header {
			border-top: none;
			border-left: none;
			border-right: none;
			padding-top: 2px;
		}

		.ui-tabs .ui-tabs-nav {
			padding-top: 2px;
		}

		div.name {
			font-weight: bold;
			margin-left: 131px;
		}

		div.forteachers {
			margin-left: 131px;
		}

		div.outcome {
			clear: both;
		}

		i.yellow {
			color: yellow;
		}

		i.red {
			color: red;
		}

		i.green {
			color: green;
		}
		
		.fa-angle-double-out:before{
			content:"\f102"
		}
		
		.fa-angle-double-in:before{
			content:"\f103"
		}
		
		@media (min-width: 992px) { 
			#toggle {
				background-color: #eeeeee;
			}

			#sidebar {
				/* for the animation */
				transition: margin 0.3s ease;
				border-right: 1px solid black;
			}

			.collapsed {
				display: block;
				/* same width as sidebar */
				margin-left: -25%;
			}

			#toggle-container {
				left: -1px;
				top: 0;
			}

			.fa-angle-double-out:before {
				content:"\f100"
			}
			
			.fa-angle-double-in:before {
				content:"\f101"
			}
		 }
	</style>
</head>

<body>
	<div class="container-fluid h-100">
		<div class="row h-100">
			<div class="col-lg-3 col-lg-push-9 collapsed" id="sidebar">
				<div id="tabs">
					<ul>
						<li>
							<a href="#senateTab">KY Senate</a>
						</li>
						<li>
							<a href="#houseTab">KY House</a>
						</li>
					</ul>
					<div id="senateTab">
						<h2>Your Senator</h2>
						<div id="senate">
							<p>Click where you live on the map to see your senate information.</p>
						</div>
					</div>
					<div id="houseTab">
						<h2>Your Representative</h2>
						<div id="house">
							<p>Click where you live on the map to see your house of representative information.</p>
						</div>
					</div>
				</div>
			</div>
			<div class="col-lg-12 h-100" id="content">
				<div id="toggle-container">
					<span id="toggle" class="toggle-sidebar">
						<i class="fas fa-angle-double-in"></i>
					</span>
				</div>
				<div id="map">
				</div>
			</div>
		</div>
		<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
		 crossorigin="anonymous"></script>
		<script src="https://code.jquery.com/ui/1.12.0/jquery-ui.min.js" integrity="sha256-eGE6blurk5sHj+rmkfsGYeKyZx3M4bG+ZlFyA7Kns7E="
		 crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
		 crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
		 crossorigin="anonymous"></script>
		<script>
			jQuery = $;
			var mapApp = (function () {
				self = this;

				var map;
				var bounds;
				var geocoder;
				var $sidebar = $("#sidebar");
				var $senate = $("#senate");
				var $house = $("#house");

				$("#tabs").tabs();

				self.houseData = {};
				self.senateData = {};

				function fitBounds() {
					map.fitBounds(bounds, 0);
				}

				function toggleSidebar() {
					$sidebar.toggleClass("collapsed");
					$("#content").toggleClass("col-lg-12 col-lg-9");
					$("#toggle i").toggleClass("fa-angle-double-in fa-angle-double-out");
					if ($("#sidebar.collapsed").length) {
						fitBounds();
					}
				}

				function getdiv($div, name, photo, forTeachers, party, opponent, simplename) {
					$div.empty();

					var forText;
					var desText;
					if (forTeachers === "Nay") {
						forText = "<i class='fa fa-check green'></i>&nbsp;Voted <span class='foreachers'>in support of</span> teachers on <span class='sb151'>SB151</span>.";
						desText = "If you are a " + party + " and want to say thank you, vote with your teachers on May 22nd. Vote for " + simplename + ". Let's keep supporters of our teachers in office.";
					}
					else if (forTeachers === "Yea") {
						forText = "<i class='fa fa-ban red'></i>&nbsp;Voted <span class='foreachers'>against</span> teachers on <span class='sb151'>SB151</span>.";
						if (opponent) {
							desText = "If you are a " + party + " and want to send a signal that teachers are not political pawns, vote with teachers vote for " + opponent + " on May 22nd. Let's vote " + simplename + " out of the primary race.";
						} else {
							desText = "Unfortunately " + simplename + " doesn't have any opponents in the May 22nd primary. To support teachers, please vote \"I support education\" or just \"Teachers\" in the \"Write-In\" section of the ballot.";
						}
					} else {
						forText = "<i class='fa fa-question yellow'></i>&nbsp;Didn't vote on <span class='sb151'>SB151</span>.";
						if (opponent) {
							desText = "If you are a " + party + " and want to send a signal that our elected officials should defend teachers, vote with teachers. Vote for " + opponent + " on May 22nd. Let's vote " + name + " out of the primary race.";
						} else {
							desText = "Unfortunately " + simplename + " doesn't have any opponents in the May 22nd primary. To support teachers, please vote \"I support education\" or just \"Teachers\" in the \"Write-In\" section of the ballot.";
						}
					}

					$div.html(`<div class='image-container'><img class='photo' src='` + photo + `' alt='Photo of ` + simplename + `' /></div>
						<div class='name'>(` + party.charAt(0) + ") " + name + `</div>
						<div class='forteachers'>` + forText + `</div>
						<div class='outcome'>` + desText + `</div>
					`);

					return $div;
				}

				function updateData(houseId, repName, repPhoto, senateId, senName, senPhoto) {
					var houseResult = $.grep(self.houseData, function (x) { return x.id == houseId })[0];
					var houseDiv = getdiv($house, houseResult.incumbent, repPhoto, houseResult.vote, houseResult.party, houseResult.opponent, repName);

					var senateResult = $.grep(self.senateData, function (x) { return x.id == senateId; })[0];
					var senDiv = getdiv($senate, senateResult.incumbent, senPhoto, senateResult.vote, senateResult.party, senateResult.opponent, senName);

					if ($("#sidebar.collapsed").length) {
						toggleSidebar();
					}
				}

				$("#toggle").click(function () {
					toggleSidebar();
				});

				self.initMap = function () {
					map = new google.maps.Map(document.getElementById('map'), {
						center: new google.maps.LatLng(37.76792991127481, -85.76869238281249),
						zoom: 8,
						mapTypeId: google.maps.MapTypeId.ROADMAP,
						zoomControl: true,
						mapTypeControl: false,
						scaleControl: true,
						streetViewControl: false,
						rotateControl: true,
						fullscreenControl: false
					});
					geocoder = new google.maps.Geocoder();
					bounds = new google.maps.LatLngBounds();
					bounds.extend(new google.maps.LatLng(36.498987, -89.575435));
					bounds.extend(new google.maps.LatLng(39.233692, -82.040874));
					var layer = new google.maps.FusionTablesLayer({
						map: map,
						heatmap: { enabled: false },
						suppressInfoWindows: false,
						query: {
							select: "geometry",
							from: "138Y1ve5dqA1xpxXO_pZvSa-j9Bu5B_Is012b_8Ii"
						},
						options: {
							styleId: 2,
							templateId: 2
						}
					});
					google.maps.event.addListener(layer, 'click', function (e) {
						var houseId = e.row['House District'].value;
						var repName = e.row['Representative'].value;
						var repPhoto = e.row['Representative Photo'].value;

						var senateId = e.row['Senate District'].value;
						var senName = e.row['Senator'].value;
						var senPhoto = e.row['Senator Photo'].value;

						updateData(houseId, repName, repPhoto, senateId, senName, senPhoto);
					});
					fitBounds();
				}
				$(window).resize(function () {
					fitBounds();
				});

				$.ajax({
					type: "get",
					dataType: "json",
					url: "Senate.json",
					success: function (data) {
						self.senateData = data;
					}
				});

				$.ajax({
					type: "get",
					dataType: "json",
					url: "House.json",
					success: function (data) {
						self.houseData = data;
					},
					error: function (jxhr, status, error) {
						debugger;
					}
				});

				return self;
			})();
		</script>
		<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCyR_6F8uTjb-lC0yApaMx22754dpiFYkQ&callback=mapApp.initMap"></script>
</body>

</html>